#!/bin/sh

# Skip the hook if we're in the middle of an interactive rebase
if [ -n "$GIT_SEQUENCE_EDITOR" ]; then
  echo "Skipping prepare-commit-msg hook due to rebase."
  exit 0
fi

# Also skip if we're in a rebase directory
if [ -d ".git/rebase-merge" ] || [ -d ".git/rebase-apply" ]; then
  echo "Skipping prepare-commit-msg hook due to rebase."
  exit 0
fi

# Enforce conventional branch names: <type>/<short-description>
BRANCH_NAME=$(git symbolic-ref --short HEAD 2>/dev/null || true)

case "$BRANCH_NAME" in
  feat/*|fix/*|chore/*|docs/*|refactor/*|test/*|ci/*|build/*|perf/*)
    ;;
  *)
    echo "Invalid branch name: $BRANCH_NAME" >&2
    echo "Expected: feat/*, fix/*, chore/*, docs/*, refactor/*, test/*, ci/*, build/*, perf/*" >&2
    exit 1
    ;;
esac


